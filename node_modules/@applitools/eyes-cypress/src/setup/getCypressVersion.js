const fs = require('fs')
const path = require('path')
const cwd = process.cwd()

function getCypressVersion() {
  const cypressPackage = require.resolve('cypress', {paths: [cwd]})
  const cypressPath = path.dirname(cypressPackage)
  const candidatePaths = [path.resolve(cypressPath, '../package.json'), path.resolve(cypressPath, 'package.json')]
  const packageJsonPath = candidatePaths.find(fs.existsSync)
  if (!packageJsonPath) {
    throw new Error('Cannot find Cypress package.json. Searched paths:\n' + candidatePaths.join('\n'))
  }
  const packageJson = JSON.parse(fs.readFileSync(packageJsonPath))
  return packageJson.version
}

module.exports = getCypressVersion
